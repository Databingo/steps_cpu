# Minimal RISC-V 64-bit Linux kernel config for BusyBox initramfs under QEMU virt
# Fixed: Added CMDLINE for root=/dev/ram; SLUB_TINY + XZ for size; disabled unused virtio/serial
#

# Essential architecture (from tinyconfig + virt)
CONFIG_64BIT=y
CONFIG_RISCV=y
CONFIG_ARCH_VIRT=y
CONFIG_MMU=y
CONFIG_CMODEL_MEDANY=y
CONFIG_PAGE_OFFSET=0x80000000
CONFIG_PAGE_SIZE_4KB=y
CONFIG_ARCH_MMAP_RND_BITS=18

# Core kernel (minimal from tiny + essentials)
CONFIG_CC_OPTIMIZE_FOR_SIZE=y
CONFIG_PRINTK=y
CONFIG_BUG=y
CONFIG_SYSCTL=y
CONFIG_PREEMPT_NONE=y
CONFIG_TINY_RCU=y
CONFIG_HZ_250=y
CONFIG_HZ=250

# Compression (XZ for kernel Image; GZIP for initrd)
CONFIG_KERNEL_XZ=y
CONFIG_ZLIB_INFLATE=y
CONFIG_DECOMPRESS_GZIP=y
CONFIG_RD_GZIP=y

# Initramfs/initrd support
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE=""
CONFIG_BLK_DEV_RAM=y  # Explicit for /dev/ram

# Boot command line (fixes root= without changing QEMU append)
CONFIG_CMDLINE_BOOL=y
CONFIG_CMDLINE="root=/dev/ram console=ttyS0"

# Memory model (flat, no hotplug)
CONFIG_SELECT_MEMORY_MODEL=y
CONFIG_FLATMEM_MANUAL=y
CONFIG_FLATMEM=y
CONFIG_SPARSEMEM=n
CONFIG_MEMORY_HOTPLUG=n

# Allocator (SLUB_TINY for minimal size)
CONFIG_SLUB=y
CONFIG_SLUB_TINY=y
CONFIG_SLAB=n

# Essential filesystems (for initramfs mounts)
CONFIG_TMPFS=y
CONFIG_PROC_FS=y
CONFIG_SYSFS=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# Block layer (minimal for ramdisk)
CONFIG_BLOCK=y

# Serial console (8250 for QEMU virt UART)
CONFIG_SERIAL_EARLYCON=y
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_EARLYCON_RISCV_SBI=y
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y
CONFIG_SERIAL_8250_NR_UARTS=1
CONFIG_DUMMY_CONSOLE=y
CONFIG_SERIAL_OF_PLATFORM=y

# Device tree / FDT (for QEMU DTB parsing; fixes OpenSBI handoff hang)
CONFIG_DTC=y
CONFIG_OF=y
CONFIG_OF_FLATTREE=y
CONFIG_OF_EARLY_FLATTREE=y
CONFIG_OF_KOBJ=y
CONFIG_OF_ADDRESS=y
CONFIG_OF_IRQ=y
CONFIG_OF_RESERVED_MEM=y

# RISC-V specifics (keep C extension for QEMU)
CONFIG_RISCV_ISA_C=y
CONFIG_RISCV_ISA_VENDOR_EXT=n
CONFIG_RISCV_MISALIGNED=y
CONFIG_RISCV_SCALAR_MISALIGNED=y
CONFIG_OPTIMIZE_INLINING=y

# Disable extras (no input/net/power/debug/fs/crypto)
CONFIG_INPUT=n
CONFIG_VT=n
CONFIG_UNIX98_PTYS=n
CONFIG_LEGACY_PTYS=n
CONFIG_PCI=n
CONFIG_SCSI=n
CONFIG_USB=n
CONFIG_NET=n
CONFIG_KALLSYMS=n
CONFIG_DEBUG_KERNEL=n
CONFIG_DEBUG_INFO=n
CONFIG_FTRACE=n
CONFIG_PROFILING=n
CONFIG_PERF_EVENTS=n
CONFIG_BPF=n
CONFIG_TRACING=n
CONFIG_MEMTEST=n
CONFIG_EXT4_FS=n
CONFIG_BTRFS_FS=n
CONFIG_XFS_FS=n
CONFIG_FAT_FS=n
CONFIG_MISC_FILESYSTEMS=n
CONFIG_CRYPTO=n
CONFIG_NAMESPACES=n
CONFIG_SYSVIPC=n
CONFIG_POSIX_MQUEUE=n
CONFIG_CGROUPS=n
CONFIG_PM=n
CONFIG_HIBERNATION=n

# Disable unneeded virtio (no disk/net in your QEMU cmd)
CONFIG_VIRTIO=n
CONFIG_VIRTIO_BLK=n
CONFIG_VIRTIO_CONSOLE=n
CONFIG_VIRTIO_MMIO=n

# Disable SiFive-specific UART (not for QEMU virt)
CONFIG_SERIAL_SIFIVE=n

# EFI (disabled; OpenSBI handles boot, not needed for minimal)
CONFIG_EFI=n
CONFIG_EFI_STUB=n
