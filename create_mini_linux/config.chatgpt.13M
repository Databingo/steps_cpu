
# Minimal RISC-V 64-bit Linux kernel config for BusyBox initramfs under QEMU
# Based on your provided config, reduced with Stages 1-3

CONFIG_64BIT=y
CONFIG_RISCV=y
CONFIG_ARCH_VIRT=y
CONFIG_MMU=y
CONFIG_CC_OPTIMIZE_FOR_SIZE=y
CONFIG_PRINTK=y
CONFIG_BUG=y

# Initramfs support
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE=""
CONFIG_RD_GZIP=y

# Essential filesystems
CONFIG_TMPFS=y
CONFIG_PROC_FS=y
CONFIG_SYSFS=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# Serial console
CONFIG_SERIAL_EARLYCON=y
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_EARLYCON_RISCV_SBI=y
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y

# Virtio (keep block for later rootfs on disk if needed)
CONFIG_VIRTIO=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_MMIO=y

# Memory model (flatmem, no sparse/hotplug)
CONFIG_SELECT_MEMORY_MODEL=y
CONFIG_FLATMEM_MANUAL=y
CONFIG_FLATMEM=y
CONFIG_SPARSEMEM=n
CONFIG_MEMORY_HOTPLUG=n

# Scheduler & RCU
CONFIG_PREEMPT_NONE=y
CONFIG_TINY_RCU=y

# Block layer
CONFIG_BLOCK=y

# Disable input/keyboard/mouse
CONFIG_INPUT=n
CONFIG_VT=n
CONFIG_UNIX98_PTYS=n
CONFIG_LEGACY_PTYS=n

# Disable PCI/USB/SCSI
CONFIG_PCI=n
CONFIG_SCSI=n
CONFIG_USB=n

# Disable networking for now
CONFIG_NET=n

# Disable debugging & profiling
CONFIG_KALLSYMS=n
CONFIG_DEBUG_KERNEL=n
CONFIG_DEBUG_INFO=n
CONFIG_FTRACE=n
CONFIG_PROFILING=n
CONFIG_PERF_EVENTS=n
CONFIG_BPF=n
CONFIG_TRACING=n
CONFIG_MEMTEST=n

# Filesystems (only tmpfs/proc/sysfs)
CONFIG_EXT4_FS=n
CONFIG_BTRFS_FS=n
CONFIG_XFS_FS=n
CONFIG_FAT_FS=n
CONFIG_MISC_FILESYSTEMS=n

# Crypto (minimal, only gzip/xz inflate)
CONFIG_CRYPTO=n
CONFIG_ZLIB_INFLATE=y
CONFIG_DECOMPRESS_GZIP=y

# Disable namespaces, cgroups, ipc
CONFIG_NAMESPACES=n
CONFIG_SYSVIPC=n
CONFIG_POSIX_MQUEUE=n
CONFIG_CGROUPS=n

# Disable power management & hibernation
CONFIG_PM=n
CONFIG_HIBERNATION=n

# Minimal allocator
CONFIG_SLAB=y
CONFIG_SLUB=n

# Remove extra RISC-V vendor extensions (keep C for QEMU)
CONFIG_RISCV_ISA_C=y
CONFIG_RISCV_ISA_VENDOR_EXT=n

# Optimizations
CONFIG_OPTIMIZE_INLINING=y
CONFIG_SYSCTL=y



# Device tree / FDT
CONFIG_DTC=y
CONFIG_OF=y
CONFIG_OF_FLATTREE=y
CONFIG_OF_EARLY_FLATTREE=y
CONFIG_OF_KOBJ=y
CONFIG_OF_ADDRESS=y
CONFIG_OF_IRQ=y
CONFIG_OF_RESERVED_MEM=y

# Serial / console (RISC-V)
CONFIG_SERIAL_EARLYCON=y
CONFIG_SERIAL_EARLYCON_RISCV_SBI=y
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_OF_PLATFORM=y
CONFIG_SERIAL_SIFIVE=y
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y
CONFIG_PRINTK=y

# dev nodes
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# virtio console (optional)
CONFIG_VIRTIO_CONSOLE=y
CONFIG_VIRTIO_MMIO=y
